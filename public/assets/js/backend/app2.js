angular.module("backend",["ui.bootstrap","angular-loading-bar","ngFileUpload","textAngular","ngTagsInput","ngSanitize","ui.select","ckeditor","angularLazyImg"]).value("admin_path","/controlcenter"),angular.module("backend").controller("adminController",["$scope","$http","$window","$log","admin_path","Upload","$timeout","$uibModal",function(t,e,a,n,o,i,l,r){t.villas={},t.villaList=[],t.offersVilla=[],t.reviewsVilla=[],t.testimonialVilla=[],t.offersList=[],t.bedroom={},t.bedroomList=[],t.formData={},t.environmentList=[],t.seasonList=[],t.galleryGroupList=[],t.galleryList=[],t.areaList=[],t.contentSuccess=!1,t.contentFailed=!1,t.rateVillas=[],t.villaBedroomList=[],t.itemRate=[],t.itemGallery=[],t.numSeasons=0,t.rate={},t.existBedroomSeason=!1,t.rateFailed=!0,t.rateSuccess=!0,t.ifImages=!0,t.offers={},t.reviews={},t.languageList=[],t.contentFormatList=[],t.formatRightList=[],t.countryList=[],t.multipleBedroom={},t.statusList=[{value:"draft",title:"draft"},{value:"live",title:"live"}],t.reviewsType=[{value:"manual",title:"Manual"},{value:"auto",title:"Auto"}],t.villas.Status="draft",t.isAdvancedSearch=!1,t.advancedSearch=function(){t.isAdvancedSearch=!0},t.maxDate=t.maxDate?null:new Date,t.openStart=function(e){e.preventDefault(),e.stopPropagation(),t.datepicker={openStart:!0}},t.endStart=function(e){e.preventDefault(),e.stopPropagation(),t.datepicker={endStart:!0}},t.dateOptions={formatYear:"yy",startingDay:1},t.intro={language:"en",allowedContent:!0,entities:!1},t.description={language:"en",allowedContent:!0,entities:!1},t.services={language:"en",allowedContent:!0,entities:!1},t.facilities={language:"en",allowedContent:!0,entities:!1},t.staff_detail={language:"en",allowedContent:!0,entities:!1},t.term_condition={language:"en",allowedContent:!0,entities:!1},t.ReviewsComment={language:"en",allowedContent:!0,entities:!1},t.TestimonialComment={language:"en",allowedContent:!0,entities:!1},t.getBedrooms=function(){e({method:"GET",url:o+"/api/bedroom"}).then(function(e){n.info(e.data),angular.forEach(e.data,function(e,a){t.bedroomList.push({id:e.id,title:e.title,number:e.number})})},function(t){n.info(t)}),t.multipleBedroom.selectedItem=t.bedroomList[0]},t.getVillaRateList=function(a){e({method:"GET",url:o+"/api/rates/"+a+"/villa"}).then(function(e){n.info(e.data),angular.forEach(e.data,function(e,a){t.itemRate.push({VillaId:e.VillaId,Bedroom:e.Bedroom,Season:e.Season,StartDate:e.StartDate,EndDate:e.EndDate,MinimumStay:e.MinimumStay,Tax:e.Tax,Plus:e.Plus,Rate:e.Rate,SeasonTitle:e.SeasonTitle,BedroomTitle:e.BedroomTitle,RateId:e.RateId})})},function(t){n.info(t)})},t.getSeasons=function(){e({method:"GET",url:o+"/api/season"}).then(function(e){angular.forEach(e.data.season,function(e,a){t.seasonList.push({id:e.id,title:e.title})}),t.numSeasons=e.data.numseasons},function(t){n.info(t)})},t.getGalleryGroups=function(){e({method:"GET",url:o+"/api/gallery-group"}).then(function(e){n.info(e.data),angular.forEach(e.data,function(e,a){t.galleryGroupList.push({id:e.id,title:e.title})})},function(t){n.info(t)})},t.getEnvironments=function(){e({method:"GET",url:o+"/api/environment"}).then(function(e){n.info(e.data),angular.forEach(e.data,function(e,a){t.environmentList.push({id:e.id,title:e.title})})},function(t){n.info(t)})},t.getAreas=function(){e({method:"GET",url:o+"/api/area"}).then(function(e){angular.forEach(e.data,function(e,a){t.areaList.push({id:e.id,title:e.title})})},function(t){n.info(t)})},t.getVillaList=function(){e({method:"GET",url:o+"/api/villa"}).then(function(e){n.info(e.data),angular.forEach(e.data,function(e,a){t.villaList.push({id:e.id,title:e.title,status:1==e.status?"Live":"Draft",featured:1==e.featured?"Featured":"",area:e.area.title,rateUrl:o+"/villa/"+e.id+"/rates",galleryUrl:o+"/villa/"+e.id+"/gallery",editUrl:o+"/villa/"+e.id+"/edit",deleteUrl:o+"/villa/"+e.id})})},function(t){n.info(t)})},t.getSpecialOffersList=function(){e({method:"GET",url:o+"/api/special-offers"}).then(function(e){n.info(e.data),angular.forEach(e.data,function(e,a){t.offersList.push({id:e.id,title:e.title,period_end:e.period_end,villa_name:e.villa.title,editUrl:o+"/special-offers/"+e.id+"/edit",deleteUrl:o+"/special-offers/"+e.id})})},function(t){n.info(t)})},t.offersVillaList=function(){e({method:"GET",url:o+"/api/villa"}).then(function(e){n.info(e.data),angular.forEach(e.data,function(e,a){t.offersVilla.push({id:e.id,title:e.title,area:e.area.title})})},function(t){n.info(t)})},t.postReviews=function(i){n.info(i),e({method:"POST",url:o+"/reviews",data:i}).then(function(e){1==e.data.status?a.location.href=o+"/reviews/?stat=1":(t.contentFailed=!0,t.failedMessage="Failed added content",t.errors=e.data.data)},function(t){n.info(t)})},t.postTestimonials=function(i){n.info(i),e({method:"POST",url:o+"/testimonial",data:i}).then(function(e){1==e.data.status?a.location.href=o+"/testimonial/?stat=1":(t.contentFailed=!0,t.failedMessage="Failed added content",t.errors=e.data.data)},function(t){n.info(t)})},t.getReviews=function(){e({method:"GET",url:o+"/api/reviews"}).then(function(e){n.info(e.data),angular.forEach(e.data,function(e,a){t.reviewsVilla.push({id:e.id,villa:e.villa!=null?e.villa.title:null,guestName:e.guest_name,period_stay:e.arrival_date,status:e.status,approvedUrl:o+"/reviews/"+e.id+"/approve"})}),n.info(t.reviewsVilla)},function(t){n.info(t)})},t.getTestimonials=function(){e({method:"GET",url:o+"/api/testimonial"}).then(function(e){n.info(e.data),angular.forEach(e.data,function(e,a){t.testimonialVilla.push({id:e.id,guestName:e.guest_name,status:e.status,approvedUrl:o+"/testimonial/"+e.id+"/approve"})})},function(t){n.info(t)})},t.postVillaOffers=function(a){n.info(a),e({method:"POST",url:o+"/special-offers",data:a}).then(function(e){1==e.data.status?(t.contentSuccess=!0,t.successMessage="Content succesfully added to database",t.offers={}):(t.contentFailed=!0,t.failedMessage="Failed added content",t.errors=e.data.data)},function(t){n.info(t)})},t.editSpecialOffers=function(i){n.info("param"),n.info(i),e({method:"PUT",url:o+"/special-offers/"+i.Id,data:i}).then(function(e){1==e.data.status?a.location.href=o+"/special-offers/?stat=1":(t.contentFailed=!0,t.failedMessage="Failed update content",t.errors=e.data.data)},function(t){n.info(t)})},t.getSpecialOffers=function(a){e({method:"GET",url:o+"/api/special-offers/"+a+"/edit"}).then(function(e){n.info(e.data),t.offers=e.data,t.offers.StartDate=new Date(e.data.StartDate),t.offers.EndDate=new Date(e.data.EndDate)},function(t){n.info(t)})},t.offersModal=function(i){var l="sm";t.deleteOffers=i;var s=r.open({templateUrl:o+"/offers-modal",controller:"OffersController",size:l,resolve:{items:function(){return t.deleteOffers}}});s.result.then(function(l){e({method:"DELETE",url:o+"/special-offers/"+l,data:i}).then(function(e){1==e.data.status?a.location.reload():(t.contentFailed=!0,t.failedMessage="Failed delete content",t.errors=e.data.data)},function(t){n.info(t)})},function(){n.info("Modal dismissed at: "+new Date)})},t.reviewModal=function(i){var l="sm";t.deleteReviews=i;var s=r.open({templateUrl:o+"/reviews-modal",controller:"ReviewsController",size:l,resolve:{items:function(){return t.deleteReviews}}});s.result.then(function(l){e({method:"DELETE",url:o+"/reviews/"+l,data:i}).then(function(e){1==e.data.status?a.location.reload():(t.contentFailed=!0,t.failedMessage="Failed delete content",t.errors=e.data.data)},function(t){n.info(t)})},function(){n.info("Modal dismissed at: "+new Date)})},t.testimonialModal=function(i){var l="sm";t.deleteTestimonial=i;var s=r.open({templateUrl:o+"/testimonial-modal",controller:"TestimonialController",size:l,resolve:{items:function(){return t.deleteTestimonial}}});s.result.then(function(l){e({method:"DELETE",url:o+"/testimonial/"+l,data:i}).then(function(e){1==e.data.status?a.location.reload():(t.contentFailed=!0,t.failedMessage="Failed delete content",t.errors=e.data.data)},function(t){n.info(t)})},function(){n.info("Modal dismissed at: "+new Date)})},t.getVillas=function(a){e({method:"GET",url:o+"/api/villa/"+a+"/edit"}).then(function(e){t.villas=e.data,0===t.villas.Status?t.villas.Status="draft":t.villas.Status="live",1===t.villas.Featured?t.villas.Featured=!0:t.villas.Featured=!1},function(t){n.info(t)})},t.postVillas=function(a){n.info("param"),n.info(a),e({method:"POST",url:o+"/villa",data:a}).then(function(e){1==e.data.status?(t.contentFailed=!1,t.contentSuccess=!0,t.successMessage="Content succesfully added to database",t.villas={}):(t.contentSuccess=!1,t.contentFailed=!0,t.failedMessage="Failed added content",t.errors=e.data.data)},function(t){n.info(t)})},t.editVillas=function(i){e({method:"PUT",url:o+"/villa/"+i.Id,data:i}).then(function(e){1==e.data.status?a.location.href=o+"/villa/?stat=1":(t.contentFailed=!0,t.failedMessage="Failed update content",t.errors=e.data.data)},function(t){n.info(t)})},t.villaModal=function(i){var l="sm";t.deleteVilla=i;var s=r.open({templateUrl:o+"/villa-modal",controller:"VillaController",size:l,resolve:{items:function(){return t.deleteVilla}}});s.result.then(function(l){e({method:"DELETE",url:o+"/villa/"+l,data:i}).then(function(e){1==e.data.status?a.location.reload():(t.contentFailed=!0,t.failedMessage="Failed delete content",t.errors=e.data.data)},function(t){n.info(t)})},function(){n.info("Modal dismissed at: "+new Date)})},t.getVillaBedrooms=function(a){e({method:"GET",url:o+"/api/villa/"+a+"/bedrooms"}).then(function(e){angular.forEach(e.data,function(e,a){t.villaBedroomList.push({id:e.id,title:e.title})}),t.getVillaRateList(a)},function(t){n.info(t)})},t.addRates=function(e,a){function o(e,a){var o,i;n.info("Bedroom: "+e),n.info("Season: "+a),angular.forEach(t.itemRate,function(l,r){o=l.Bedroom.indexOf(e),i=l.Season.indexOf(a),n.info("get bedroom: "+o),n.info("get season: "+i),0==o&&0==i&&(t.existBedroomSeason=!0)})}function i(e){var a=null;return angular.forEach(t.seasonList,function(t,n){t.id==e&&(a=t.title)}),a}function l(e){var a=null;return angular.forEach(t.villaBedroomList,function(t,n){t.id==e&&(a=t.title)}),a}o(e.Bedrooms,e.Seasons),1==t.existBedroomSeason?(t.rateFailed=!1,t.rateMessage="Bedroom and season already exist.",t.existBedroomSeason=!1):(t.rateFailed=!0,n.info(i(e.Seasons)),t.itemRate.push({VillaId:a,Bedroom:e.Bedrooms,Season:e.Seasons,StartDate:null,EndDate:null,MinimumStay:null,Tax:null,Plus:null,Rate:null,SeasonTitle:i(e.Seasons),BedroomTitle:l(e.Bedrooms),RateId:0}))},t.saveRates=function(i){n.info(i),e({method:"POST",url:o+"/rates",data:i}).then(function(e){n.info(e),1==e.data.status?(t.rateFailed=!0,t.rateSuccess=!1,t.rateMessage=e.data.data,a.location.href=o+"/villa/"+i.VillaId+"/rates"):0==e.data.status?(t.rateFailed=!1,t.rateSuccess=!0,t.rateMessage="Failed added rate",t.errors=e.data.data):3==e.data.status?(t.rateFailed=!1,t.rateSuccess=!0,t.rateMessage="Failed added rate",t.errors=e.data.data):4==e.data.status&&(t.rateFailed=!0,t.rateSuccess=!1,t.rateMessage=e.data.data)},function(t){n.info(t)})},t.addImages=function(e,a){6>a&&(t.ifImages=!1,t.itemGallery.push({VillaId:e,Caption:null,Group:null,MainImage:!1,Images:null}))},t.listGallery=function(a){e({method:"GET",url:o+"/api/gallery/"+a+"/list"}).then(function(e){n.info(e.data),angular.forEach(e.data,function(e,a){t.galleryList.push({Id:e.id,Caption:e.caption,Image:e.path,Group:e.group_id,MainImage:1==e.main_image})})},function(t){n.info(t)})},t.editGallery=function(i){e({method:"PUT",url:o+"/gallery/"+i.Id,data:i}).then(function(e){1==e.data.status?a.location.reload():(t.contentFailed=!0,t.failedMessage="Failed update content",t.errors=e.data.data)},function(t){n.info(t)})},t.galleryModal=function(i){var l="sm";t.deleteGallery=i;var s=r.open({templateUrl:o+"/gallery-modal",controller:"GalleryController",size:l,resolve:{items:function(){return t.deleteGallery}}});s.result.then(function(l){e({method:"DELETE",url:o+"/gallery/"+l,data:i}).then(function(e){1==e.data.status?a.location.reload():(t.contentFailed=!0,t.failedMessage="Failed delete content",t.errors=e.data.data)},function(t){n.info(t)})},function(){n.info("Modal dismissed at: "+new Date)})},t.doUpload=function(e){if(n.info(e),e&&e.length){t.loading=!0;for(var l=0;l<e.length;l++){var r=e[l].Images;i.upload({url:o+"/gallery",file:r,fields:{id:e[l].VillaId,caption:e[l].Caption,group_id:e[l].Group,main_image:e[l].MainImage}}).progress(function(e){t.loading=!1}).success(function(e){t.loading=!1,1===e.status&&a.location.reload()}).error(function(){t.loading=!1,n.info("error upload image")})}}},t.countries=function(){e({method:"GET",url:o+"/api/countries"}).then(function(e){angular.forEach(e.data,function(e,a){t.countryList.push({id:a,name:e})})},function(t){n.info(t)})}}]),angular.module("backend").controller("profileController",["$scope","$http","$log","admin_path","$filter","$uibModal","Upload","$window",function(t,e,a,n,o,i,l,r){t.countryList=[],t.maxDate=t.maxDate?null:new Date,t.openDOB=function(e){e.preventDefault(),e.stopPropagation(),t.datepicker={openedDOB:!0}},t.dateOptions={formatYear:"yy",startingDay:1},t.countries=function(){e({method:"GET",url:n+"/api/countries"}).then(function(e){angular.forEach(e.data,function(e,a){t.countryList.push({id:a,name:e})})},function(t){a.info(t)})},t.getProfile=function(o){t.profile={},e({method:"GET",url:n+"/profile/"+o+"/edit"}).then(function(e){angular.forEach(e.data,function(e,a){t.profile=e,t.profile.dob=new Date(e.dob)})},function(t){a.info(t)}),t.countries()},t.updateProfile=function(i,l){i.dob=o("date")(i.dob,"yyyy-MM-dd"),e({method:"PUT",url:n+"/profile/"+l,data:i}).then(function(e){1===e.data.status&&(t.alertProfile=!0,t.alertMessage="Profile Updated!"),a.info(e.data.status)},function(t){a.info(responses)})},t.updatePassword=function(o,i){t.alertPassword=!1,t.alertPasswordWrong=!1,e({method:"PUT",url:n+"/profile/changepwd/"+i,data:o}).then(function(e){a.info(e),1===e.data.status?(t.alertPassword=!0,t.alertMessage="Password updated!",t.password.current=null,t.password.new1=null,t.password.new2=null):2===e.data.status&&(t.alertPasswordWrong=!0,t.alertMessageWrong="Your current password is wrong!")},function(t){a.info(responses)})},t.uploadPhoto=function(){t.isUpload=!0},t.cancelPhoto=function(){t.isUpload=!1},t.doUpload=function(e,o){if(t.loading=!0,e&&e.length)for(var i=0;i<e.length;i++){var s=e[i];l.upload({url:n+"/profile",file:s,fields:{id:o}}).progress(function(e){t.loading=!1,a.info("evt"),a.info(e)}).success(function(e){t.loading=!1,a.info("resp2"),a.info(e),1===e.status&&r.location.reload()}).error(function(){t.loading=!1})}}}]),angular.module("backend").controller("GalleryController",["$scope","admin_path","$uibModalInstance","$log","items",function(t,e,a,n,o){t.ok=function(){a.close(o.Id)},t.cancel=function(){a.dismiss("cancel")}}]),angular.module("backend").controller("VillaController",["$scope","admin_path","$uibModalInstance","$log","items",function(t,e,a,n,o){t.ok=function(){a.close(o.id)},t.cancel=function(){a.dismiss("cancel")}}]),angular.module("backend").controller("OffersController",["$scope","admin_path","$uibModalInstance","$log","items",function(t,e,a,n,o){t.ok=function(){a.close(o.id)},t.cancel=function(){a.dismiss("cancel")}}]),angular.module("backend").controller("ReviewsController",["$scope","admin_path","$uibModalInstance","$log","items",function(t,e,a,n,o){t.ok=function(){a.close(o.id)},t.cancel=function(){a.dismiss("cancel")}}]),angular.module("backend").controller("TestimonialController",["$scope","admin_path","$uibModalInstance","$log","items",function(t,e,a,n,o){t.ok=function(){a.close(o.id)},t.cancel=function(){a.dismiss("cancel")}}]),angular.module("backend").filter("propsFilter",function(){return function(t,e){var a=[];if(angular.isArray(t)){var n=Object.keys(e);t.forEach(function(t){for(var o=!1,i=0;i<n.length;i++){var l=n[i],r=e[l].toLowerCase();if(-1!==t[l].toString().toLowerCase().indexOf(r)){o=!0;break}}o&&a.push(t)})}else a=t;return a}}),angular.module("backend").directive("villaavail",["$q","$http","$log","admin_path",function(t,e,a,n){return{require:"ngModel",link:function(a,o,i,l){l.$asyncValidators.villaavail=function(a){var o=t.defer();return e({method:"GET",url:n+"/api/villa/"+a+"/exist"}).success(function(t){t.error===!1&&t.exist===!1?o.resolve():o.reject()}).error(function(){o.reject()}),o.promise}}}}]);